<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"></meta>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>chatr</title>
        <style>
            .jumbotron {
            color:black ;
            }
            #server-time{
                font-family: 'Franklin Gothic Medium', 'Arial Narrow';
                font-size: large;
                text-align: right;
            }
            .style{
                padding: 5px;
                padding-bottom: 50px;
                border: 3px solid rgb(112, 100, 100);
                border-radius: 15px;
                font-family: Georgia, 'Times New Roman', Times, serif;
            }
            .con{
                margin: 50px;
                padding-bottom: 20px;
            }
            .contain{
                margin: 30px;
                font-size: medium;
                overflow: scroll;
                scroll-behavior: auto,smooth;
            }
            .dis{
                font-family: Verdana, Geneva, Tahoma, sans-serif;
                font-size: medium;
                overflow-x:hidden;
                overflow-y: visible;
                margin: 2px;
            }
            .snd{
                scroll-behavior: auto;
                text-align: center;
            }
            #divusr{
                display: inline;
            }
            #divmsg{
                display:none;
            }
            #alert{
                display: none;
            }
            .messaged{
                font-size: 20px;
                font-family: Verdana, Geneva, Tahoma, sans-serif;  
            }
            #happy{
                display: none;
            }
        </style>
        <script src="/socket.io/socket.io.js"></script>
    </head>
    <body>
        <div class="jumbotron text-center">
            <h1 style="text-align: center;font-family: Cursive;" >RCHaT</h1> 
            <div id="divusr">
                <div class="form-inline">
                    <input type="text" class="form-control" id="user" autofocus size="50" placeholder="Name" required>
                    <button type="button" class="btn btn-primary" id="usrbut">Chat Now..</button>
                </div>
            </div>
            <div id="happy">
                <label id="txt"  style="text-align: center;font-family: Cursive;"></label>
                <p><button class="btn btn-primary" onclick="left()">leave</button></p>
            </div>
        </div>  
        <div id="server-time"></div>
        <div class="contain" id="divmsg">
            <div class="con">
              <div class="style">
                <div id="message_dis" class="dis"></div>
              </div>
              <br>
              <div class="snd" >
                <div id="divusr">
                    <div class="form-inline">
                        <input type="text" placeholder="Type your message.." class="form-control" autofocus size="50" id="msg" required>
                        <button type="button" class="btn btn-primary" id="snd">Send</button>
                        <label id="alert" >plzz enter the message</label>&nbsp;&nbsp;
                    </div>
                </div>
              </div>
            </div>
        </div>
          <script>
            var socket=io();
            var msgdis=document.getElementById('message_dis');
            var input=document.getElementById('msg');
            var usrin=document.getElementById('user');
            usrin.addEventListener("keyup",function(event){
                if (event.keyCode===13){
                    document.getElementById("usrbut").click();
                    input.value="";}
            });
            document.getElementById('usrbut').onclick=function(){
                var usrname=document.getElementById('user').value;
                var divmsg=document.getElementById('divmsg').style;
                var divusr=document.getElementById('divusr').style;
                var hap=document.getElementById('happy');
                var hap1=document.getElementById('txt');
                socket.emit('user',usrname);
                hap1.innerHTML=`Happy..Chatting ${usrname}`;
                divusr.display="none";
                divmsg.display="inline";
                hap.style.display="inline";
            }
            function left(){
                socket.emit('dis',usrin.value);
                location.reload();
            }
            input.addEventListener("keyup",function(event){
                if (event.keyCode===13){
                    document.getElementById("snd").click();
                    input.value="";}
            });
            document.getElementById('snd').onclick = function(){
                var usrname=document.getElementById('user').value;
                msgdis.scrollTop=msgdis.scrollHeight;
                var msg=document.getElementById('msg').value;
                socket.emit('send message',msg,usrname);
                console.log(usrname);
                msg="";
                input.value="";
            }
            socket.on('broadcast',function(data){
                var usrname=document.getElementById('user').value;
                if (data.usr!=usrname){msgdis.innerHTML+=`<div class="messaged" style="text-align: center"><b>${data.des}</b></div><br>`;}
                else{msgdis.innerHTML+=`<div class="messaged" style="text-align: center" ><b>You are in...</b></div><br>`;}
            });
            socket.on('errusr',function(data){
                alert(data.des);
                location.reload();
            })
            socket.on('new message',function(data){
                var usrname=document.getElementById('user').value;
                var al=document.getElementById('alert').style;
                if (data.msg.length!=0){
                    if (data.usr==usrname){
                        msgdis.innerHTML+=`<div class="messaged" ><b>You : </b>${data.msg}</div><br>`;
                    }
                    else{
                        msgdis.innerHTML+=`<div class="messaged" ><b>${data.usr} </b>: ${data.msg}</div><br>`;
                    }
                    al.display="none";
                }
                else{
                    
                    al.display="inline";
                }
            });
            socket.on('time', function(timeString) {
                el = document.getElementById('server-time')
                el.innerHTML = 'Server : ' + timeString;
            });
            socket.on('bye',function(data){
                var usrname=document.getElementById('user').value;
                if (data.usr!=usrname){msgdis.innerHTML+=`<div class="messaged" style="text-align: center"><b>${data.des}</b></div><br>`;}
                else{msgdis.innerHTML+=`<div class="messaged" style="text-align: center" ><b>You are left</b></div><br>`;}
            });
          </script>
          <div style="text-align: left;"><label style="opacity: 30%;">Created By &nbsp;:&nbsp; Ramanathan</label>
        <p><b>GitHub &nbsp; :&nbsp;</b>&nbsp;<a href="http://github.com/Ramanathan87">GitHub</a></p></div>
    </body>
</html> 
